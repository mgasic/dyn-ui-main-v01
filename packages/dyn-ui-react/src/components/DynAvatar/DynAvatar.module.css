/**
 * DynAvatar Component Styles
 * 
 * ✅ Token Compliant:
 * - All tokens follow --dyn-avatar-* pattern
 * - 3-level fallback for all tokens (dyn → legacy → hardcoded)
 * - Component-scoped token definitions
 * - No :root scope leakage
 * - Foundation tokens imported from design system
 * 
 * ✅ Features Implemented:
 * - Size variants: xs, sm, md (default), lg, xl
 * - Shape variants: circle (default), square, rounded
 * - Status indicators: online, away, busy, offline
 * - Badge overlay support (integrated with DynBadge)
 * - Loading state with spinner animation
 * - Error state visualization
 * - Interactive states with hover/focus/active
 * 
 * ✅ Accessibility:
 * - Dark mode support: @media (prefers-color-scheme: dark)
 * - High contrast support: @media (prefers-contrast: more)
 * - Reduced motion support: @media (prefers-reduced-motion: reduce)
 * - Focus ring for keyboard navigation
 * - WCAG AA color contrast compliant
 * - Screen reader friendly structure
 */

/* ============================================
   COMPONENT-SCOPED TOKEN DEFINITIONS
   Moved from :root to component scope
   Following DESIGN-TOKENS-STABILIZATION-ROADMAP.md
   ============================================ */

.container {
  /* ===== SIZE TOKENS ===== */
  /* Replace legacy --dyn-size-* with component-specific tokens */
  --dyn-avatar-size-xs: var(--dyn-size-xs, var(--legacy-size-xs, 24px));
  --dyn-avatar-size-sm: var(--dyn-size-sm, var(--legacy-size-sm, 32px));
  --dyn-avatar-size-md: var(--dyn-size-md, var(--legacy-size-md, 40px));
  --dyn-avatar-size-lg: var(--dyn-size-lg, var(--legacy-size-lg, 56px));
  --dyn-avatar-size-xl: var(--dyn-size-xl, var(--legacy-size-xl, 80px));
  
  /* ===== FONT SIZE TOKENS ===== */
  --dyn-avatar-font-size-xs: var(--dyn-font-size-xs, var(--legacy-font-size-xs, 10px));
  --dyn-avatar-font-size-sm: var(--dyn-font-size-sm, var(--legacy-font-size-sm, 12px));
  --dyn-avatar-font-size-md: var(--dyn-font-size-base, var(--legacy-font-size-base, 14px));
  --dyn-avatar-font-size-lg: var(--dyn-font-size-lg, var(--legacy-font-size-lg, 16px));
  --dyn-avatar-font-size-xl: var(--dyn-font-size-xl, var(--legacy-font-size-xl, 20px));
  
  /* ===== BORDER TOKENS ===== */
  --dyn-avatar-border-width: var(--dyn-border-width-default, var(--legacy-border-width, 2px));
  --dyn-avatar-border-color: var(--dyn-color-border-default, var(--legacy-color-border, #d1d5db));
  --dyn-avatar-border-color-hover: var(--dyn-color-border-hover, var(--legacy-color-border-hover, #9ca3af));
  
  /* ===== BORDER RADIUS TOKENS ===== */
  --dyn-avatar-radius-circle: 50%;
  --dyn-avatar-radius-square: 0;
  --dyn-avatar-radius-rounded: var(--dyn-radius-md, var(--legacy-radius-md, 8px));
  
  /* ===== BACKGROUND COLOR TOKENS ===== */
  --dyn-avatar-bg-default: var(--dyn-color-primary-50, var(--legacy-color-primary-light, #eff6ff));
  --dyn-avatar-bg-hover: var(--dyn-color-surface-hover, var(--legacy-color-surface-hover, #f9fafb));
  --dyn-avatar-bg-error: var(--dyn-color-danger-50, rgba(239, 68, 68, 0.1));
  
  /* ===== TEXT COLOR TOKENS ===== */
  --dyn-avatar-text-default: var(--dyn-color-primary-700, var(--legacy-color-primary, #2563eb));
  --dyn-avatar-text-inverse: var(--dyn-color-neutral-0, var(--legacy-color-text-inverse, #ffffff));
  
  /* ===== STATUS INDICATOR TOKENS ===== */
  --dyn-avatar-status-size: var(--dyn-spacing-3, var(--legacy-spacing-3, 12px));
  --dyn-avatar-status-border-width: var(--dyn-border-width-default, var(--legacy-border-width, 2px));
  --dyn-avatar-status-border-color: var(--dyn-color-surface, var(--legacy-color-surface, #ffffff));
  
  /* Status colors */
  --dyn-avatar-status-online: var(--dyn-color-status-online, var(--legacy-color-success, #10b981));
  --dyn-avatar-status-away: var(--dyn-color-status-away, var(--legacy-color-warning, #f59e0b));
  --dyn-avatar-status-busy: var(--dyn-color-status-busy, var(--legacy-color-danger, #ef4444));
  --dyn-avatar-status-offline: var(--dyn-color-status-offline, var(--legacy-color-text-secondary, #6b7280));
  
  /* ===== BADGE OVERLAY TOKENS ===== */
  --dyn-avatar-badge-offset: var(--dyn-spacing-0, var(--legacy-spacing-0, -4px));
  --dyn-avatar-badge-size: var(--dyn-spacing-5, var(--legacy-spacing-5, 20px));
  --dyn-avatar-badge-padding: var(--dyn-spacing-1, var(--legacy-spacing-1, 0 4px));
  --dyn-avatar-badge-bg: var(--dyn-color-primary-600, var(--legacy-color-primary, #2563eb));
  --dyn-avatar-badge-border-width: var(--dyn-border-width-default, var(--legacy-border-width, 2px));
  --dyn-avatar-badge-border-color: var(--dyn-color-surface, var(--legacy-color-surface, #ffffff));
  --dyn-avatar-badge-text: var(--dyn-color-neutral-0, var(--legacy-color-text-inverse, #ffffff));
  
  /* ===== FOCUS STATE TOKENS ===== */
  --dyn-avatar-focus-ring-color: var(--dyn-color-focus-ring, var(--legacy-color-primary, #2563eb));
  --dyn-avatar-focus-ring-width: var(--dyn-border-width-thick, var(--legacy-border-width-thick, 2px));
  --dyn-avatar-focus-ring-offset: var(--dyn-spacing-1, var(--legacy-spacing-1, 2px));
  
  /* ===== LOADING SPINNER TOKENS ===== */
  --dyn-avatar-spinner-color: var(--dyn-color-primary-600, var(--legacy-color-primary, #2563eb));
  --dyn-avatar-spinner-width: var(--dyn-border-width-default, var(--legacy-border-width, 2px));
  --dyn-avatar-spinner-size: 50%;
  
  /* ===== TRANSITION TOKENS ===== */
  --dyn-avatar-transition-duration: var(--dyn-transition-duration, var(--legacy-transition-duration, 180ms));
  --dyn-avatar-transition-timing: var(--dyn-transition-timing, var(--legacy-transition-timing, ease));
  
  /* ===== TRANSFORM TOKENS ===== */
  --dyn-avatar-scale-hover: 1.05;
  --dyn-avatar-scale-active: 0.98;
  
  /* ===== Z-INDEX TOKENS ===== */
  --dyn-avatar-z-index-badge: var(--dyn-z-index-elevated, var(--legacy-z-index-badge, 1));
  --dyn-avatar-z-index-spinner: var(--dyn-z-index-elevated, var(--legacy-z-index-elevated, 10));
}

/* ============================================
   BASE AVATAR STYLES
   ============================================ */

.container {
  position: relative;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: var(--dyn-avatar-size-md);
  height: var(--dyn-avatar-size-md);
  background-color: var(--dyn-avatar-bg-default);
  border: var(--dyn-avatar-border-width) solid var(--dyn-avatar-border-color);
  border-radius: var(--dyn-avatar-radius-circle);
  color: var(--dyn-avatar-text-default);
  font-family: var(--dyn-font-family-base, var(--legacy-font-family-base, system-ui, -apple-system, sans-serif));
  font-size: var(--dyn-avatar-font-size-md);
  font-weight: var(--dyn-font-weight-semibold, var(--legacy-font-weight-semibold, 600));
  overflow: hidden;
  user-select: none;
  flex-shrink: 0;
  transition: 
    background-color var(--dyn-avatar-transition-duration) var(--dyn-avatar-transition-timing),
    border-color var(--dyn-avatar-transition-duration) var(--dyn-avatar-transition-timing),
    transform var(--dyn-avatar-transition-duration) var(--dyn-avatar-transition-timing);
}

/* ============================================
   CONTENT ELEMENTS
   ============================================ */

.image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: opacity var(--dyn-avatar-transition-duration) var(--dyn-avatar-transition-timing);
}

.initials {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  text-transform: uppercase;
  letter-spacing: 0.02em;
  transition: opacity var(--dyn-avatar-transition-duration) var(--dyn-avatar-transition-timing);
}

/* ============================================
   SIZE VARIANTS
   ============================================ */

.xs {
  width: var(--dyn-avatar-size-xs);
  height: var(--dyn-avatar-size-xs);
  font-size: var(--dyn-avatar-font-size-xs);
}

.sm {
  width: var(--dyn-avatar-size-sm);
  height: var(--dyn-avatar-size-sm);
  font-size: var(--dyn-avatar-font-size-sm);
}

.md {
  width: var(--dyn-avatar-size-md);
  height: var(--dyn-avatar-size-md);
  font-size: var(--dyn-avatar-font-size-md);
}

.lg {
  width: var(--dyn-avatar-size-lg);
  height: var(--dyn-avatar-size-lg);
  font-size: var(--dyn-avatar-font-size-lg);
}

.xl {
  width: var(--dyn-avatar-size-xl);
  height: var(--dyn-avatar-size-xl);
  font-size: var(--dyn-avatar-font-size-xl);
}

/* ============================================
   SHAPE VARIANTS
   ============================================ */

.circle {
  border-radius: var(--dyn-avatar-radius-circle);
}

.square {
  border-radius: var(--dyn-avatar-radius-square);
}

.rounded {
  border-radius: var(--dyn-avatar-radius-rounded);
}

/* ============================================
   STATUS INDICATOR
   Positioned absolutely at bottom-right
   ============================================ */

.status {
  position: absolute;
  bottom: 0;
  right: 0;
  width: var(--dyn-avatar-status-size);
  height: var(--dyn-avatar-status-size);
  border-radius: var(--dyn-avatar-radius-circle);
  border: var(--dyn-avatar-status-border-width) solid var(--dyn-avatar-status-border-color);
  background-color: var(--dyn-avatar-status-offline);
  z-index: var(--dyn-avatar-z-index-badge);
}

.statusOnline {
  background-color: var(--dyn-avatar-status-online);
}

.statusAway {
  background-color: var(--dyn-avatar-status-away);
}

.statusBusy {
  background-color: var(--dyn-avatar-status-busy);
}

.statusOffline {
  background-color: var(--dyn-avatar-status-offline);
}

/* Responsive status indicator sizes */
.xs .status {
  width: var(--dyn-spacing-2, var(--legacy-spacing-2, 8px));
  height: var(--dyn-spacing-2, var(--legacy-spacing-2, 8px));
  border-width: var(--dyn-border-width-thin, var(--legacy-border-width-thin, 1px));
}

.sm .status {
  width: var(--dyn-spacing-2, var(--legacy-spacing-2, 10px));
  height: var(--dyn-spacing-2, var(--legacy-spacing-2, 10px));
}

.lg .status {
  width: var(--dyn-spacing-4, var(--legacy-spacing-4, 16px));
  height: var(--dyn-spacing-4, var(--legacy-spacing-4, 16px));
}

.xl .status {
  width: var(--dyn-spacing-5, var(--legacy-spacing-5, 20px));
  height: var(--dyn-spacing-5, var(--legacy-spacing-5, 20px));
  border-width: var(--dyn-border-width-thick, var(--legacy-border-width-thick, 3px));
}

/* ============================================
   INTERACTIVE STATES
   Applied when clickable prop is true
   ============================================ */

.clickable {
  cursor: pointer;
}

.clickable:hover {
  background-color: var(--dyn-avatar-bg-hover);
  border-color: var(--dyn-avatar-border-color-hover);
  transform: scale(var(--dyn-avatar-scale-hover));
}

.clickable:focus-visible {
  outline: var(--dyn-avatar-focus-ring-width) solid var(--dyn-avatar-focus-ring-color);
  outline-offset: var(--dyn-avatar-focus-ring-offset);
}

.clickable:active {
  transform: scale(var(--dyn-avatar-scale-active));
}

/* ============================================
   LOADING STATE
   Hides content and shows spinner animation
   ============================================ */

.container.loading {
  pointer-events: none;
}

/* Hide initials and image during loading */
.container.loading .initials,
.container.loading .image {
  opacity: 0;
  visibility: hidden;
}

/* Animated loading spinner */
.container.loading::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: var(--dyn-avatar-spinner-size);
  height: var(--dyn-avatar-spinner-size);
  margin-top: calc(var(--dyn-avatar-spinner-size) / -2);
  margin-left: calc(var(--dyn-avatar-spinner-size) / -2);
  border: var(--dyn-avatar-spinner-width) solid transparent;
  border-top-color: var(--dyn-avatar-spinner-color);
  border-right-color: var(--dyn-avatar-spinner-color);
  border-radius: var(--dyn-avatar-radius-circle);
  animation: avatarSpin 0.8s linear infinite;
  z-index: var(--dyn-avatar-z-index-spinner);
}

@keyframes avatarSpin {
  to {
    transform: rotate(360deg);
  }
}

/* ============================================
   ERROR STATE
   Applies error styling when image fails to load
   ============================================ */

.error {
  border-color: var(--dyn-color-danger-600, var(--legacy-color-danger, #ef4444));
  background-color: var(--dyn-avatar-bg-error);
}

/* ============================================
   BADGE OVERLAY
   Integrated with DynBadge component
   Used for notification counts and custom badges
   ============================================ */

.badge {
  position: absolute;
  top: var(--dyn-avatar-badge-offset);
  right: var(--dyn-avatar-badge-offset);
  display: flex;
  align-items: center;
  justify-content: center;
  min-width: var(--dyn-avatar-badge-size);
  height: var(--dyn-avatar-badge-size);
  padding: var(--dyn-avatar-badge-padding);
  background-color: var(--dyn-avatar-badge-bg);
  border: var(--dyn-avatar-badge-border-width) solid var(--dyn-avatar-badge-border-color);
  border-radius: var(--dyn-avatar-radius-circle);
  color: var(--dyn-avatar-badge-text);
  font-size: var(--dyn-avatar-font-size-xs);
  font-weight: var(--dyn-font-weight-bold, var(--legacy-font-weight-bold, 700));
  z-index: var(--dyn-avatar-z-index-badge);
  line-height: 1;
  white-space: nowrap;
}

/* Badge positioned wrapper - DynBadge will handle its own positioning */
.badgeContainer {
  position: absolute;
  top: 0;
  right: 0;
  z-index: var(--dyn-avatar-z-index-badge);
}

/* Responsive badge sizes */
.xs .badge {
  min-width: var(--dyn-spacing-3, var(--legacy-spacing-3, 14px));
  height: var(--dyn-spacing-3, var(--legacy-spacing-3, 14px));
  font-size: var(--dyn-font-size-2xs, var(--legacy-font-size-2xs, 10px));
  padding: var(--dyn-spacing-0, var(--legacy-spacing-0, 0 2px));
}

.sm .badge {
  min-width: var(--dyn-spacing-4, var(--legacy-spacing-4, 16px));
  height: var(--dyn-spacing-4, var(--legacy-spacing-4, 16px));
  font-size: var(--dyn-font-size-xs, var(--legacy-font-size-xs, 11px));
}

.lg .badge {
  min-width: var(--dyn-spacing-6, var(--legacy-spacing-6, 24px));
  height: var(--dyn-spacing-6, var(--legacy-spacing-6, 24px));
  font-size: var(--dyn-font-size-sm, var(--legacy-font-size-sm, 13px));
  padding: var(--dyn-spacing-1, var(--legacy-spacing-1, 0 6px));
}

.xl .badge {
  min-width: var(--dyn-spacing-8, var(--legacy-spacing-8, 32px));
  height: var(--dyn-spacing-8, var(--legacy-spacing-8, 32px));
  font-size: var(--dyn-font-size-base, var(--legacy-font-size-base, 14px));
  padding: var(--dyn-spacing-2, var(--legacy-spacing-2, 0 8px));
}

/* ============================================
   REDUCED MOTION SUPPORT
   Removes animations for users who prefer reduced motion
   ============================================ */

@media (prefers-reduced-motion: reduce) {
  .container,
  .image,
  .initials {
    transition: none;
  }

  .clickable:hover,
  .clickable:active {
    transform: none;
  }

  .container.loading::after {
    animation: none;
    /* Show static spinner */
    border-top-color: var(--dyn-avatar-spinner-color);
    border-right-color: transparent;
  }
}

/* ============================================
   HIGH CONTRAST MODE SUPPORT
   Increases border widths for better visibility
   ============================================ */

@media (prefers-contrast: more) {
  .container {
    border-width: var(--dyn-border-width-thick, var(--legacy-border-width-thick, 3px));
  }

  .status {
    border-width: var(--dyn-border-width-thick, var(--legacy-border-width-thick, 3px));
  }

  .badge {
    border-width: var(--dyn-border-width-thick, var(--legacy-border-width-thick, 3px));
  }

  .container.loading::after {
    border-width: var(--dyn-border-width-thick, var(--legacy-border-width-thick, 3px));
  }
}

/* ============================================
   DARK MODE SUPPORT
   All tokens updated for dark color scheme
   ============================================ */

@media (prefers-color-scheme: dark) {
  .container {
    /* Override tokens for dark mode */
    --dyn-avatar-bg-default: var(--dyn-color-primary-900, rgba(59, 130, 246, 0.15));
    --dyn-avatar-text-default: var(--dyn-color-primary-300, var(--legacy-color-primary-dark, #3b82f6));
    --dyn-avatar-border-color: var(--dyn-color-border-dark, var(--legacy-color-border-dark, #334155));
    --dyn-avatar-border-color-hover: var(--dyn-color-border-dark-hover, var(--legacy-color-border-dark-hover, #475569));
    --dyn-avatar-bg-hover: var(--dyn-color-surface-hover-dark, var(--legacy-color-surface-hover-dark, #334155));
    --dyn-avatar-spinner-color: var(--dyn-color-primary-400, var(--legacy-color-primary-dark, #3b82f6));
    --dyn-avatar-status-border-color: var(--dyn-color-surface-dark, var(--legacy-color-surface-dark, #1e293b));
    --dyn-avatar-badge-border-color: var(--dyn-color-surface-dark, var(--legacy-color-surface-dark, #1e293b));
  }

  .error {
    border-color: var(--dyn-color-danger-400, var(--legacy-color-danger-dark, #ef4444));
    background-color: rgba(239, 68, 68, 0.15);
  }
}

/* ============================================
   RESPONSIVE ADJUSTMENTS
   Adjust sizes on smaller screens
   ============================================ */

@media (max-width: 640px) {
  /* Scale down larger avatars on mobile */
  .xl {
    width: var(--dyn-avatar-size-lg);
    height: var(--dyn-avatar-size-lg);
    font-size: var(--dyn-avatar-font-size-lg);
  }
}

/* ============================================
   FUTURE: GROUP AVATARS
   Commented out - planned for Phase 3
   ============================================ */

/* 
TODO: Uncomment when implementing avatar groups feature
Currently not used by DynAvatar component.
Will need Phase 3 feature branch for proper implementation.

.group {
  display: flex;
  padding: var(--dyn-spacing-sm, var(--legacy-spacing-sm, 8px));
}

.groupItem {
  margin-left: var(--dyn-avatar-group-margin-negative, var(--legacy-avatar-group-margin-negative, -8px));
  border-width: var(--dyn-border-width-thick, var(--legacy-border-width-thick, 3px));
  border-color: var(--dyn-color-surface, var(--legacy-color-surface, #ffffff));
}

.groupItem:first-child {
  margin-left: 0;
}
*/